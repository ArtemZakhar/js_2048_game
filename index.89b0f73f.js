var t={},e="idle",n="playing",s={num:()=>.9>=Math.random()?2:4,position(t){let e=Math.floor(4*Math.random());for(;!t[e].includes(0);)e=Math.floor(4*Math.random());let n=Math.floor(4*Math.random());for(;0!==t[e][n];)n=Math.floor(4*Math.random());return[e,n]}},l=t=>{let e=t.map(t=>[...t]),n=s.num(),[l,r]=s.position(e);return e[l][r]=n,e},r=()=>{let t=l([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]);return l(t)},i=t=>{let e=!0;for(let n=0;n<t.length;n+=1){let s=[t.length-1,t[t.length-1][n]],l=null;for(let r=t.length-1;r>=0;r-=1){let i=t[r][n];if(0===i){if(null!==l)continue;l=r;continue}if(s[1]===i&&s[0]!==r){t[s[0]][n]=2*i,t[r][n]=0,l=r,s[0]-=1,r+=1,s[1]=t[s[0]][n],e=!1;continue}if(null!==l){t[l][n]=i,s[0]=l,s[1]=i,l-=1,t[r][n]=0,e=!1;continue}if(s[1]!==i){s[0]-=1,s[1]=i;continue}}}return!e&&t},o=t=>{let e=!0;for(let n=0;n<t.length;n+=1){let s=t[n],l=[0,s[0]],r=null;for(let i=0;i<s.length;i+=1){let o=s[i];if(0===o){if(null!==r)continue;r=i;continue}if(l[1]===o&&l[0]!==i){t[n][l[0]]=2*o,t[n][i]=0,r=i,l[0]+=1,i-=1,l[1]=t[i][l[0]],e=!1;continue}if(null!==r){t[n][r]=o,l[0]=r,l[1]=o,r+=1,t[n][i]=0,e=!1;continue}if(l[1]!==o){l[0]+=1,l[1]=o;continue}}}return!e&&t},a=t=>{let e=!0;for(let n=0;n<t.length;n+=1){let s=t[n],l=[s.length-1,s[s.length-1]],r=null;for(let i=s.length-1;i>=0;i-=1){let o=s[i];if(0===o){if(null!==r)continue;r=i;continue}if(l[1]===o&&l[0]!==i){t[n][l[0]]=2*o,t[n][i]=0,r=i,l[0]-=1,i+=1,l[1]=t[i][l[0]],e=!1;continue}if(null!==r){t[n][r]=o,l[0]=r,l[1]=o,r-=1,t[n][i]=0,e=!1;continue}if(l[1]!==o){l[0]-=1,l[1]=o;continue}}}return!e&&t},c=t=>{let e=!0;for(let n=0;n<t.length;n+=1){let s=[0,t[0][n]],l=null;for(let r=0;r<t.length;r+=1){let i=t[r][n];if(0===i){if(null!==l)continue;l=r;continue}if(s[1]===i&&s[0]!==r){t[s[0]][n]=2*i,t[r][n]=0,l=r,s[0]+=1,r-=1,s[1]=t[s[0]][n],e=!1;continue}if(null!==l){t[l][n]=i,s[0]=l,s[1]=i,l+=1,t[r][n]=0,e=!1;continue}if(s[1]!==i){s[0]+=1,s[1]=i;continue}}}return!e&&t},u=t=>{[...document.querySelector("tbody").children].forEach((e,n)=>{[...e.children].forEach((e,s)=>{if(e.children.length)e.lastChild.classList.add("hide"),new Promise(t=>{setTimeout(()=>t(),75)}).then(()=>{e.removeChild(e.lastChild);let l=document.createElement("div");l.classList.add("field-cell"),l.style.cssText="display: flex; justify-content: center; align-items: center;";let r=t[n][s];r&&l.classList.add(`field-cell--${r}`),l.textContent=0===r?"":r,e.append(l)});else{let l=document.createElement("div");l.classList.add("field-cell"),l.style.cssText="display: flex; justify-content: center; align-items: center;";let r=t[n][s];r&&l.classList.add(`field-cell--${r}`),l.textContent=0===r?"":r,e.append(l)}})})};t=class{state=[];status=e;constructor(t){this.state=t}moveLeft(){if(this.getStatus()!==n)return;let t=o(this.getState());this.applyChanges(t)}moveRight(){if(this.getStatus()!==n)return;let t=a(this.getState());this.applyChanges(t)}moveUp(){if(this.getStatus()!==n)return;let t=c(this.getState());this.applyChanges(t)}moveDown(){if(this.getStatus()!==n)return;let t=i(this.getState());this.applyChanges(t)}getScore(){return this.status===e?0:this.state.flat().reduce((t,e)=>t+e,0)}getState(){return this.state.map(t=>[...t])}getStatus(){return this.status}start(){this.status=n,u(this.getState())}restart(){this.state=r(),u(this.getState())}applyChanges(t){if(!t)return;if(this.isFull(t)){this.gameOver();return}let e=l(t);this.state=e,u(e),this.has2048(this.state)&&this.winner()}isFull(t){return t.flat().every(t=>0!==t)}gameOver(){this.status="lose",document.querySelector(".message-lose").classList.remove("hidden")}has2048(t){return t.flat().includes(2048)}winner(){this.status="win",document.querySelector(".message-win").classList.remove("hidden")}};const h=document.querySelector(".controls button"),d=document.querySelector(".game-score"),f=new t(r());document.body.style.overflowY="hidden",h.addEventListener("click",()=>{h.classList.contains("start")?(h.classList.remove("start"),h.classList.add("restart"),h.textContent="Restart",f.start()):f.restart(),document.querySelector(".message-start").classList.add("hidden");let t=f.getScore();d.textContent=t}),document.addEventListener("keydown",t=>{if("ArrowRight"===t.key){f.moveRight();let t=f.getScore();d.textContent=t}if("ArrowLeft"===t.key){f.moveLeft();let t=f.getScore();d.textContent=t}if("ArrowUp"===t.key){f.moveUp();let t=f.getScore();d.textContent=t}if("ArrowDown"===t.key){f.moveDown();let t=f.getScore();d.textContent=t}}),(t=>{let e=document.querySelector("tbody"),n=document.querySelector(".game-score"),s=0,l=0,r=0,i=0;return e.addEventListener("touchstart",t=>{s=t.changedTouches[0].screenX,r=t.changedTouches[0].screenY}),e.addEventListener("touchend",e=>{l=e.changedTouches[0].screenX,i=e.changedTouches[0].screenY,function(){Math.abs(s-l)>Math.abs(r-i)?(s-l>20&&t.moveLeft(),l-s>20&&t.moveRight()):(r-i>20&&t.moveUp(),i-r>20&&t.moveDown());let e=t.getScore();n.textContent=e}()}),()=>{e.removeEventListener("touchstart",touchStartHandler),e.removeEventListener("touchend",touchEndHandler)}})(f);
//# sourceMappingURL=index.89b0f73f.js.map
